{"version":3,"file":"tsconfig.js","sourceRoot":"","sources":["../../../src/lib/ts/tsconfig.ts"],"names":[],"mappings":"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","sourcesContent":["import * as ng from '@angular/compiler-cli/src/perform_compile';\n// XX: has or is using name 'ParsedConfiguration' ... but cannot be named\nimport { ParsedConfiguration } from '@angular/compiler-cli/src/perform_compile';\nimport * as path from 'path';\nimport * as ts from 'typescript';\nimport { NgEntryPoint } from '../ng-package-format/entry-point';\n\n/**\n * TypeScript configuration used internally (marker typer).\n */\nexport type TsConfig = ng.ParsedConfiguration;\n\n/**\n * Reads the default TypeScript configuration.\n */\nexport function readDefaultTsConfig(fileName?: string): TsConfig {\n  if (!fileName) {\n    fileName = path.resolve(__dirname, 'conf', 'tsconfig.ngc.json');\n  }\n\n  return ng.readConfiguration(fileName);\n}\n\n/**\n * Creates a parsed TypeScript configuration object.\n *\n * @param values File path or parsed configuration.\n */\nexport function createDefaultTsConfig(values?: TsConfig | string): TsConfig {\n  if (!values) {\n    return readDefaultTsConfig();\n  } else if (typeof values === 'string') {\n    return readDefaultTsConfig(values);\n  } else {\n    return values;\n  }\n}\n\n/**\n * Initializes TypeScript Compiler options and Angular Compiler options by overriding the\n * default config with entry point-specific values.\n */\nexport const initializeTsConfig = (defaultTsConfig: TsConfig, entryPoint: NgEntryPoint): TsConfig => {\n  const basePath = path.dirname(entryPoint.entryFilePath);\n\n  // Resolve defaults from DI token and create a deep copy of the defaults\n  let tsConfig: TsConfig = JSON.parse(JSON.stringify(defaultTsConfig));\n\n  // minimal compilerOptions needed in order to avoid errors, with their associated default values\n  // some are not overrided in order to keep the default associated TS errors if the user choose to set incorrect values\n  const requiredOptions: Partial<ts.CompilerOptions> = {\n    emitDecoratorMetadata: true,\n    experimentalDecorators: true,\n    moduleResolution: ts.ModuleResolutionKind.NodeJs,\n    target: ts.ScriptTarget.ES2015,\n    declaration: true,\n    lib: ['dom', 'es2015']\n  };\n\n  const overrideConfig: Partial<TsConfig> = {\n    rootNames: [entryPoint.entryFilePath],\n    options: {\n      flatModuleId: entryPoint.moduleId,\n      flatModuleOutFile: `${entryPoint.flatModuleFile}.js`,\n      basePath: basePath,\n      rootDir: basePath,\n      outDir: '',\n      lib: entryPoint.languageLevel ? entryPoint.languageLevel.map(lib => `lib.${lib}.d.ts`) : tsConfig.options.lib,\n      // setting this as basedir will rewire triple-slash references\n      declarationDir: basePath,\n      // required in order to avoid \"ENOENT: no such file or directory, .../.ng_pkg_build/...\" errors when using the programmatic API\n      inlineSources: true,\n      // setting the below here because these are a must have with these valus\n      inlineSourceMap: true,\n      sourceMap: false,\n      sourceRoot: `ng://${entryPoint.moduleId}`\n    }\n  };\n\n  tsConfig.rootNames = overrideConfig.rootNames;\n  tsConfig.options = { ...requiredOptions, ...tsConfig.options, ...overrideConfig.options };\n\n  switch (entryPoint.jsxConfig) {\n    case 'preserve':\n      tsConfig.options.jsx = ts.JsxEmit.Preserve;\n      break;\n    case 'react':\n      tsConfig.options.jsx = ts.JsxEmit.React;\n      break;\n    case 'react-native':\n      tsConfig.options.jsx = ts.JsxEmit.ReactNative;\n      break;\n    default:\n      break;\n  }\n\n  return tsConfig;\n};\n"]}